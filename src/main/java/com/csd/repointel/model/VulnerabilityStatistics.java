package com.csd.repointel.model;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * Model representing vulnerability statistics for a repository or across all repositories.
 */
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class VulnerabilityStatistics {
    private int totalDependencies;
    private int vulnerableDependencies;
    private int safeDependencies;
    private int unknownDependencies;
    private int outdatedDependencies;
    
    // Severity breakdown
    private int criticalCount;
    private int highCount;
    private int mediumCount;
    private int lowCount;
    
    // Risk metrics
    private double averageRiskScore;
    private int averageHealthScore;
    private int totalCves;
    
    // Version metrics
    private int averageDaysOld;
    private int mostOutdatedDays;
    private String mostOutdatedPackage;
    
    /**
     * Get percentage of vulnerable dependencies.
     */
    public double getVulnerablePercentage() {
        if (totalDependencies == 0) return 0.0;
        return (vulnerableDependencies * 100.0) / totalDependencies;
    }

    /**
     * Get percentage of safe dependencies.
     */
    public double getSafePercentage() {
        if (totalDependencies == 0) return 0.0;
        return (safeDependencies * 100.0) / totalDependencies;
    }

    /**
     * Get natural language summary.
     */
    public String getSummary() {
        StringBuilder sb = new StringBuilder();
        sb.append("Found ").append(totalDependencies).append(" dependencies. ");
        sb.append(vulnerableDependencies).append(" vulnerable, ");
        sb.append(safeDependencies).append(" safe, ");
        sb.append(outdatedDependencies).append(" outdated.");
        
        if (criticalCount > 0) {
            sb.append(" ⚠️ ").append(criticalCount).append(" CRITICAL issues found!");
        } else if (highCount > 0) {
            sb.append(" ⚠️ ").append(highCount).append(" HIGH severity issues found.");
        }
        
        return sb.toString();
    }
}
